# Some commands for settings up an Angular-first MEAN full stack project

1. Generate an Angular workspace
```bash
ng new MyProject --create-application=false --new-project-root=.
```

2. Create the Angular client application
```bash
ng g application ClientApp 
# and add whatever other preferences you have, e.g. scss, routing, etc.
```

3a. Create an API or other directory for Node.js processes or Express.js
```bash
mkdir ApiApp && cd $_
mkdir bin
touch bin/www
```

3b. Add this code for an Expressjs entry file similar to what is autogenerated with the Express cli:
```javascript
#!/usr/bin/env node

/**
 * Module dependencies.
 */

const app = require('../app').default();
const debug = require('debug')('MyAPI:server');
const http = require('http');
/**
 * Get port from environment and store in Express.
 */

const port = normalizePort(process.env.PORT || '3000');
app.set('port', port);

/**
 * Create HTTP server.
 */

const server = http.createServer(app);

/**
 * Listen on provided port, on all network interfaces.
 */

server.listen(port, () => console.log(`Application is listening on port ${ port }`));
server.on('error', onError);
server.on('listening', onListening);

/**
 * Normalize a port into a number, string, or false.
 */

function normalizePort(val) {
  const port = parseInt(val, 10);

  if (isNaN(port)) {
    // named pipe
    return val;
  }

  if (port >= 0) {
    // port number
    return port;
  }

  return false;
}

/**
 * Event listener for HTTP server "error" event.
 */

function onError(error) {
  if (error.syscall !== 'listen') {
    throw error;
  }

  const bind = typeof port === 'string'
    ? 'Pipe ' + port
    : 'Port ' + port;

  // handle specific listen errors with friendly messages
  switch (error.code) {
    case 'EACCES':
      console.error(bind + ' requires elevated privileges');
      process.exit(1);
      break;
    case 'EADDRINUSE':
      console.error(bind + ' is already in use');
      process.exit(1);
      break;
    default:
      throw error;
  }
}

/**
 * Event listener for HTTP server "listening" event.
 */

function onListening() {
  const addr = server.address();
  const bind = typeof addr === 'string'
    ? 'pipe ' + addr
    : 'port ' + addr.port;
  debug('Listening on ' + bind);
}
```

4. Create `app.ts` as entry for all transpiled source code (from here, add your Express types and bootstrap the Express application as you prefer). 
Note, that the express app will serve the static files that the Angular client app transpiles to:
```typescript
const clientDir = express.static(path.join(__dirname, '../public'));
app.use(express.static(clientDir));
```



5. In `package.json`, add the following scripts to help with transpiling. Note, install `concurrently` and `nodemon` globally:
```json
    "clean": "rm -rf ./dist/api && rm -rf ./dist/public/",
    "cp:www": "mkdir -p ./dist/api/bin && cp api/bin/www ./dist/api/bin/",
    "dev": "concurrently -k \"tsc -p ./api/tsconfig.api.json -w\" \"cd ./dist/api && nodemon ./bin/www --watch\" \"clear && ng build --watch\"",
    "prod": "concurrently -k \"npm run clean && npm run cp:www && ng build --aot --prod && tsc -p ./api/tsconfig.api.json && cd ./dist/api && node ./bin/www\"",
    ```
Note: `clean` will start the compilation directory fresh if necessary, `cp:www` is necessary because 'api/bin/www` is skipped in the Typescript transpilation, then `dev` builds both Angular and Express.js assets and watches for changes. 
`prod` is for production.


